import std

fn extern "c" printf(fmt: *u8, ..) i32

fn main() unit = {
	ints()
	boxes()
}

fn ints() unit = {
	let a: [int] = []
	print(&a)

	let mut b: [int] = [:3]
	std.intrinsics.push(&mut b, 3)
	std.intrinsics.push(&mut b, 2)
	std.intrinsics.push(&mut b, 1)
	print(&b)
	let mut b2 = std.intrinsics.grow(b, 4)
	std.intrinsics.push(&mut b2, 0)
	print(&b2)
	let mut b3 = std.intrinsics.grow(b2, 8)
	std.intrinsics.push(&mut b3, 6)
	std.intrinsics.push(&mut b3, 7)
	print(&b3)

	let mut c = [1, 2, 3, 4, 5]
	print(&c)
	c.[1] = 69
	printf("old=%d\n".ptr, c.[2] := 42)
	print(&c)
	let mut c2 = &c.[0..3]
	print(&c2)
}

fn print(s: &[int]) unit = {
	printf("[".ptr)
	let mut i = 0
	loop if i < s.len {
		printf("%d".ptr, s.[i])
		if i < s.len - 1 {
			printf(", ".ptr)
		}
		i += 1
	}
	printf("], ptr: %p, len: %d, cap: %d\n".ptr, s.ptr, s.len, s.cap)
}

type Box(value: int)

fn boxes() unit = {
	let a = [Box(1), Box(2), Box(3)]
	let b = &a.[0]
	let c = &a.[0]
	let nested = [[Box(1), Box(2)], [Box(3)]]
}
